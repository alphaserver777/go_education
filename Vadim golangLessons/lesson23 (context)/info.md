[Простое объяснение ЮТУБ](https://www.youtube.com/watch?v=Fjkckov4F38&t=39s)
[Текстовый вариант](https://blog.ildarkarymov.ru/posts/context-guide/)

Context:
a) Хранить значения
b) Сообщать о завершении

Context в Go — это мощный инструмент для управления контекстом выполнения операций, особенно в многопоточных и сетевых приложениях.
Он позволяет передавать данные, отменять операции и устанавливать таймауты между различными частями вашего приложения.

Основные концепции:

• Контекст выполнения: Представляет собой среду, в которой выполняется операция. Он может включать в себя:

1. Значение: Данные, которые могут быть переданы между функциями (например, идентификатор запроса, информация о пользователе).
2. Сигнал отмены: Уведомление о том, что операция должна быть отменена (например, при таймауте или отмене запроса пользователем).
3. Таймаут: Максимальное время, в течение которого операция должна быть выполнена.
   • Распространение контекста: context.Context передается как первый параметр во многие функции, особенно в многопоточных и сетевых приложениях. Это позволяет передавать информацию и сигнал отмены по всей цепочке вызовов.
   • Неизменяемость: Контекст является неизменяемым. Это значит, что вы не можете напрямую изменять существующий контекст. Вместо этого, вы создаете новые контексты на основе существующих, добавляя в них значения, таймауты или сигналы отмены.

Основные функции пакета context:

1.  context.Background():

    - Создает пустой контекст, который обычно используется в начале цепочки вызовов.
    - Не имеет никаких значений, таймаутов или сигнала отмены.

2.  context.TODO():

    - Аналогичен context.Background(), но используется, когда вы временно не знаете, какой контекст использовать.
    - Рекомендуется заменять context.TODO() на более подходящий контекст в процессе разработки.

3.  context.WithValue(parent context.Context, key, val any) context.Context:

    - Создает новый контекст на основе parent контекста, добавляя в него пару "ключ-значение".
    - key и val могут быть любого типа (но обычно используют хорошо определенные типы).
    - Используйте этот метод для передачи данных, например, ID запроса.

4.  context.WithCancel(parent context.Context) (ctx context.Context, cancel context.CancelFunc):

    - Создает новый контекст на основе parent контекста, добавляя в него сигнал отмены.
    - Возвращает новый контекст ctx и функцию cancel context.CancelFunc.
    - Вызов cancel() отправляет сигнал отмены в контекст и во все его производные.
    - Используйте этот метод для отмены длительных операций.

5.  context.WithTimeout(parent context.Context, timeout time.Duration) (ctx context.Context, cancel context.CancelFunc):

    - Создает новый контекст на основе parent контекста, добавляя в него таймаут.
    - Возвращает новый контекст ctx и функцию cancel context.CancelFunc.
    - Если таймаут истекает, то в контекст отправляется сигнал отмены.
    - Используйте этот метод для установки таймаутов для сетевых вызовов или других операций.

6.  context.WithDeadline(parent context.Context, d time.Time) (ctx context.Context, cancel context.CancelFunc):

    - Похож на context.WithTimeout, но устанавливает крайний срок (deadline) для операции в виде time.Time.
    - Используется, когда нужно установить время окончания операции.

7.  ctx.Done() <-chan struct{}:

    - Возвращает канал, по которому будет отправлен сигнал (пустая структура) при отмене контекста (с помощью cancel()) или по истечению таймаута/дедлайна.
    - Используйте select, чтобы дождаться сигнала отмены.

8.  ctx.Value(key any) any:
    - Извлекает значение из контекста по заданному ключу.
    - Возвращает значение типа any (интерфейс). Необходимо приводить тип.

Примеры использования:

1.  Отмена операции:

1.  Background, TODO
1.  With value
1.  With cancel
1.  With deadline/timeout

1.  Worker pool

ПРОСТОЙ ПРИМЕР: ЧТО ТАКОЕ КОНТЕКСТ

Представьте, что вы работаете в ресторане. Вы — официант, и у вас есть несколько столов, за которыми сидят гости.

Без контекста:

• Вы бегаете между столами, принимаете заказы, носите еду, и при этом не знаете, какой заказ какому столу принадлежит.
• Если кто-то отменяет заказ, вы об этом не знаете, и продолжаете готовить блюдо.
• Если приготовление блюда занимает слишком много времени, вы об этом тоже не знаете, и не можете сказать гостю, когда будет готово.

С контекстом:

Контекст — это как папка или записная книжка, которая помогает вам управлять работой со столами:

1. context.Background() — это пустая записная книжка.
   • В начале рабочего дня у вас есть пустая записная книжка.

2. context.WithValue(parent, "tableID", 5) — вы открываете страницу для стола №5 и записываете в неё номер стола.
   • Теперь у вас есть записная книжка с информацией о том, что это заказ для стола №5.
   • Вы можете передавать эту записную книжку повару, чтобы он знал, для какого стола готовит.

3. context.WithCancel(parent) — вы создаёте страницу, где можно отметить "отмена заказа".
   • Теперь вы можете отметить на этой странице, что заказ отменён.
   • Если повар увидит эту отметку, он перестанет готовить.

4. context.WithTimeout(parent, 10 \* time.Minute) — вы ставите таймер на 10 минут.
   • Теперь у вас есть таймер, который вы поставили на 10 минут.
   • Если за 10 минут блюдо не будет готово, то повар будет знать, что нужно прекратить работу.

Итак, контекст — это:

• Записная книжка (или папка): Она хранит информацию о выполняемой операции.
• Возможность отмены: Она позволяет отменить операцию, если она больше не нужна.
• Таймер: Она позволяет ограничить время выполнения операции.
• Передача информации: Она позволяет передавать информацию между разными частями программы.

Зачем он нужен в программировании?

• Параллелизм: В программах, где работают несколько потоков, контекст помогает управлять операциями в каждом потоке.
• Сетевые запросы: Если вы делаете запрос к серверу, контекст поможет установить таймаут и отменить запрос, если он занимает слишком много времени.
• Длительные вычисления: Если ваша программа делает сложные вычисления, контекст поможет отменить их, если они больше не нужны.

Простыми словами:

context.Context - это способ передать информацию, управление отменой и таймауты от одной функции к другой в вашем Go-коде, особенно если эти функции выполняются параллельно. Он помогает сделать вашу программу более надежной и управляемой.

Надеюсь, что эта аналогия с рестораном помогла вам понять смысл контекста!
